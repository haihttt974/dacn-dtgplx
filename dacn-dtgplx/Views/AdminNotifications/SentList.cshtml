@using dacn_dtgplx.ViewModels
@model List<SentNotificationItem>

<div class="card shadow p-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-primary m-0">
            <i class="fa fa-bell"></i> Thông Báo Đã Gửi
        </h3>

        <a asp-action="Index" class="btn btn-primary">
            <i class="fa fa-plus"></i> Gửi thông báo mới
        </a>
    </div>

    <div class="accordion" id="accordionNotifications">
        @if (Model == null || !Model.Any())
        {
            <div class="text-center text-muted py-5">
                <i class="fa fa-inbox fa-3x mb-3"></i>
                <h5 class="fw-bold">Hiện chưa có thông báo nào.</h5>
                <p>Bạn hãy gửi thông báo mới để xem lịch sử tại đây.</p>
            </div>
            return;
        }
        @foreach (var item in Model.Select((tb, idx) => new { tb, idx }))
        {
            <div class="accordion-item mb-3 border rounded shadow-sm">

                <h2 class="accordion-header">
                    <button class="accordion-button collapsed fw-bold d-flex justify-content-between"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#tb_@item.tb.ThongBaoId">

                        <div>
                            <span class="me-2">@item.tb.TieuDe</span>
                            <small class="text-muted">
                                • @item.tb.TaoLuc.ToLocalTime().ToString("dd/MM/yyyy HH:mm")
                            </small>
                        </div>

                    </button>
                </h2>

                <div id="tb_@item.tb.ThongBaoId" class="accordion-collapse collapse">
                    <div class="accordion-body bg-light">

                        <div class="p-3 mb-3 rounded border bg-white shadow-sm">
                            <label class="fw-bold text-secondary">Nội dung</label>
                            <div>@item.tb.NoiDung</div>
                        </div>

                        <h5 class="fw-bold mt-4 mb-2 text-primary">
                            <i class="fa fa-users"></i> Danh sách người nhận
                        </h5>

                        <table class="table table-hover table-bordered align-middle shadow-sm bg-white">
                            <thead class="table-dark text-center">
                                <tr>
                                    <th style="width: 60px;">STT</th>
                                    <th>Họ tên</th>
                                    <th>Trạng thái</th>
                                    <th>Thời gian gửi</th>
                                </tr>
                            </thead>

                            <tbody>
                                @{
                                    int stt = 1;
                                }

                                @foreach (var u in item.tb.NguoiNhans)
                                {
                                    <tr class="text-center">
                                        <td class="fw-bold">@stt</td>

                                        <td class="text-start">@u.FullName</td>

                                        <td>
                                            @if (u.DaXem)
                                            {
                                                <span class="badge bg-success px-3 py-2">
                                                    <i class="fa fa-check-circle"></i> Đã xem
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary px-3 py-2">
                                                    <i class="fa fa-eye-slash"></i> Chưa xem
                                                </span>
                                            }
                                        </td>

                                        <td>@u.ThoiGianGui?.ToLocalTime().ToString("dd/MM/yyyy HH:mm")</td>
                                    </tr>

                                    stt++;
                                }
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        }

    </div>

</div>

<style>
    .accordion-button:not(.collapsed) {
        background-color: #e8f0ff !important;
        color: #0d6efd !important;
    }

    .accordion-item {
        border-left: 4px solid #0d6efd !important;
    }

    table thead th {
        vertical-align: middle;
    }
</style>
