@model IEnumerable<dacn_dtgplx.Models.HoSoThiSinh>

@{
    ViewData["Title"] = "Hồ sơ của tôi";
    bool? filterDaDuyet = ViewBag.FilterDaDuyet as bool?;
    int? filterIdHang = ViewBag.FilterIdHang as int?;
}

<div class="container mt-4">
    <h2 class="fw-bold mb-4">
        <i class="fa-solid fa-folder-open me-2"></i> Hồ sơ của tôi
    </h2>

    <!-- Bộ lọc -->
    <div class="card shadow-sm border-0 rounded-4 mb-4">
        <div class="card-body">

            <form method="get" class="row g-3 align-items-end">

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Trạng thái duyệt</label>
                    <select name="daDuyet" class="form-select">
                        <option value="">-- Tất cả --</option>
                        <option value="true" selected="@(filterDaDuyet == true)">Đã duyệt</option>
                        <option value="false" selected="@(filterDaDuyet == false)">Chưa duyệt</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Hạng GPLX</label>
                    <select name="idHang" class="form-select">
                        <option value="">-- Tất cả --</option>
                        @foreach (var hang in ViewBag.Hangs)
                        {
                            <option value="@hang.IdHang" selected="@(filterIdHang == hang.IdHang)">
                                @hang.MaHang - @hang.TenDayDu
                            </option>
                        }
                    </select>
                </div>

                <div class="col-md-4 d-flex gap-2">
                    <button class="btn btn-primary flex-shrink-0">
                        <i class="fa-solid fa-filter me-1"></i> Lọc
                    </button>
                    <a asp-action="MyProfile" class="btn btn-outline-secondary flex-shrink-0">Reset</a>
                </div>

            </form>

        </div>
    </div>

    <!-- Danh sách hồ sơ -->
    @if (!Model.Any())
    {
        <div class="alert alert-info rounded-4">
            Bạn chưa có hồ sơ nào.
        </div>
    }
    else
    {
        @foreach (var item in Model)
        {
            var idPhotoUrl = string.IsNullOrEmpty(item.KhamSucKhoe)
            ? Url.Content("~/images/avatar/default-id-photo.png")
            : Url.Content("~/" + item.KhamSucKhoe.TrimStart('/'));

            <div class="d-flex mb-3">
                <div class="profile-card card shadow-sm border-0 rounded-4 w-100">
                    <div class="card-body d-flex align-items-center gap-3">

                        <!-- Ảnh -->
                        <div class="flex-shrink-0">
                            <img src="@idPhotoUrl"
                                 class="rounded-3 border profile-avatar"
                                 alt="Ảnh thẻ" />
                        </div>

                        <!-- Nội dung -->
                        <div class="flex-grow-1">
                            <h5 class="fw-bold mb-2 text-primary">
                                <i class="fa-solid fa-folder me-1"></i>
                                @item.LoaiHoSo
                            </h5>

                            <p class="mb-1">
                                <b>Ngày đăng ký:</b>
                                @item.NgayDk?.ToString("dd/MM/yyyy")
                            </p>

                            <p class="mb-2">
                                <b>Trạng thái:</b>
                                @if (item.DaDuyet == true)
                                {
                                    <span class="badge bg-success px-3 py-2">Đã duyệt</span>
                                }
                                else if (item.DaDuyet == false)
                                {
                                    <span class="badge bg-danger px-3 py-2">Từ chối</span>
                                }
                                else
                                {
                                    <span class="badge bg-secondary px-3 py-2">Chưa duyệt</span>
                                }
                            </p>

                            <a asp-action="Detail"
                               asp-route-id="@item.HoSoId"
                               class="btn btn-outline-primary btn-sm px-4">
                                <i class="fa-solid fa-circle-info me-1"></i> Chi tiết
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        }
    }
</div>

<style>
    .profile-card {
        max-width: 520px; /* <-- card chỉ rộng vừa đủ thông tin */
        background-color: #ffffff;
    }

    .profile-avatar {
        width: 110px;
        height: 145px;
        object-fit: cover;
    }

    .profile-card:hover {
        background-color: #fafafa;
        transition: background-color .2s ease-in-out, box-shadow .2s;
        box-shadow: 0 0.5rem 1.2rem rgba(0, 0, 0, 0.06);
    }
</style>
